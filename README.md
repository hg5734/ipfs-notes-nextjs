# IPFS Notes

DeSci Labs is trying to improve the pace of innovation in science. We're approaching this by building tools to grow open science. One way we're doing this is by upgrading the PID system for academic research. We want to catalog and reference research outputs for the long term, and solve issues caused by the [legacy DOI system](https://doi.org).

One component of this is using content-addressed storage. [IPFS](https://ipfs.io) is an implementation of distributed content-addressed storage.

In this project we have a full-stack Next.js application using Typescript and ESLint, alongside an IPFS node managed by Docker.

Note: There is a configuration for a local IPFS node that uses a `swarm key` in order to make the node private. This key will be autogenerated by `setup.sh` (auto-ran when `npm run dev`) and placed in the `.env` file. If this key is not set, the IPFS node may not function properly in private mode.

## Requirements

1. \*nix box or Windows running WSL
2. Docker installed

### This repo here is to enable the following functions
1. Write text notes in the UI and save them to IPFS
2. Display these notes to the user on-demand

### Bonus Points (we suggest trying at least one)

1. Figure out how to allow the notes to survive between server restarts
   We can store the data in temporarily in Caching service(Redis/elastic cache etc) when server receive request before further processing like ipfs etc
   once server back online after restart, we will check pending entries from caching service and store in IPFS either via queueing system or we can process all in once based on server load.

2. Allow users to sign notes using encryption
   i have working metamask login, in which we sign the message via metamask and at backend we verify that signature
```javascript

// Generate signature 
  const signMessage = async (nonce, address) => {
    return web3.eth.personal.sign(`login${nonce}`, address)
  }
  const authenticate = async (address, signature, nonce) => {
    return (await fetch(`${serverUrl}auth`, {
      body: JSON.stringify({ address, signature, nonce }),
      headers: {
        'Content-Type': 'application/json',
      },
      method: 'POST',
    })).json()
  }
  const login = async () => {
    try {
      let userAddress = await web3Enable();
      let nonce = await fetchNonce();
      let message = await signMessage(nonce, userAddress);
      window.alert((await authenticate(userAddress, message, nonce)).message);
    } catch (error) {
      window.alert('error--' + error.message);
    }
  }
// signature verification 
let message = `login${nonce}`;
const messageHash = ethUtil.hashPersonalMessage(
  ethUtil.toBuffer(Buffer.from(message, "utf8"))
);
const signatureParams = ethUtil.fromRpcSig(ethUtil.toBuffer(signature));
const publicKey = ethUtil.ecrecover(
  messageHash,
  signatureParams.v,
  signatureParams.r,
  signatureParams.s
);
const addressBuffer = ethUtil.publicToAddress(publicKey);
const recoveredAddress = ethUtil.bufferToHex(addressBuffer).toLowerCase();
if (recoveredAddress !== address.toLowerCase()) {
  return res.status(401).send({ message: "unauthorized" });
}

My Github project for reference : https://github.com/hg5734/metamask-login
```

2. Make the UI modern and smooth (we have pre-included [TailwindCSS](https://tailwindcss.com/docs/utility-first))
3. Allow support for file uploads
4. Enable IPLD support (nested directory file management)
5. Enable search support
6. Support for 10k+ notes
7. Enable multiplayer (multiple collaborators in real-time can work on notes)
8. Enable WebGL/3D support for exploring notes (or just to look cool)
9. Write highly useful tests

# Running the code

0. `./setup.sh` (copies your local environment variables and sets your swarm key, this will be done for you in the next step)
1. `npm run dev` (starts Next.js frontend/backend)
2. `docker compose up` (starts local IPFS on port 5001)

## Blank Slate: Testing the pipes

You should be greeted with the following page on http://localhost:3000 (or another port if 3000 is taken)

![First Load](https://bafkreidka3mfik5zjdvequupqhhj3kszvtiatff3h5ylbwsb4cgqaudtsm.ipfs.dweb.link)

Then if you click "Retrieve Data" a simple API is called and information is delivered to the frontend.

![After Retrieve](https://dweb.link/ipfs/bafkreictjcnzhje6fqh72jm7ttwx7q2qlqbjp4ru36uzrddzv4ol22yuya)

## Notes

The following error message is normal, it means you're running a private IPFS node

```
ERROR   cmd/ipfs        ipfs/daemon.go:567      failed to bootstrap (no peers found): consider updating Bootstrap or Peering section of your config
```

Want to reset IPFS state? The IPFS data volume is persisted in `./local-data` you may also opt to destroy the Docker container
